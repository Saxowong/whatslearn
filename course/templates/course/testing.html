
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Whatslearn" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/static/user/css/custom.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <title>Whatslearn</title>
  </head>
  <body>
      <nav class="navbar navbar-expand-lg navbar-dark custom-navbar ps-1">
        <!-- Left Section -->
        <div class="d-flex align-items-center" id="iconbar">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a href="#" class="navbar-brand ms-2">Whatslearn</a>
        </div>
        <!-- Center Collapsible Menu -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/courses"><i class="bi bi-house-door-fill me-2"></i>Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#"><i class="bi bi-bar-chart-fill me-2"></i>Progress</a>
                </li> 
                
                 <form method="POST" action="/logout/" id="logoutForm">
                <li class="nav-item">
                    
                            <input type="hidden" name="csrfmiddlewaretoken" value="oWZVJcyKDj79eJyKLWAFrFVNED6Pv0117vmaQI5vnkkImw9PwSFtpRINYRzCbW2h">
                            <a href="#" class="nav-link" onclick="document.getElementById('logoutForm').submit(); return false;">
                                <i class="bi bi-box-arrow-right me-2"></i>Logout</a>
                    
                </li>
                
                </form>
            </ul>
        </div>
        <!-- Right Section - Profile Picture -->
            <a href="#">>
                <div class="profile-container">
                    pcwong
                        
                            <img src="/media/profile_pictures/pcwong_9Ad5s5h.jpg" 
                            alt="Profile" 
                            class="profile-pic">
                            
                </div>
            </a>        
        </nav>
    
<div class="container pt-3 ps-3">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="/courses/">Courses</a>
            </li>
            <li class="breadcrumb-item">
                <a href="/course/1/">Music Theory</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                Exercise Activity
            </li>
        </ol>
    </nav>
</div>
<div class="container mt-4">
    <div class="title-row mb-4">
        <h2 class="mb-0">Exercise Activity</h2>
    </div>
    <div class="row">
        <!-- Left Column - Activity Content -->
        <div class="col-12 col-md-8 mb-3">
            <div class="card">
                <div class="card-body">
                    <div class="activity-content">
                        
<audio id="audio-correct" preload="auto">
    <source src="/media/audio/correct.mp3" type="audio/mpeg">
</audio>
<audio id="audio-wrong" preload="auto">
    <source src="/media/audio/ah.mp3" type="audio/mpeg">
</audio>
<!-- Welcome Block with Progress Bar -->
<div id="welcomeBlock" class="text-center welcome-block p-3 mb-2 rounded">
        <!-- Progress Bar Section -->
        <div class="activity-description mb-5 text-start">
            <p>This activity has 28 questions.&nbsp; It helps you memorize all the Hebrew Alphabets.</p>
        </div>

        <div class="progress-container mb-5">
        <div class="d-flex justify-content-between mb-1">
            <span>Mastery Progress</span>
            <span>5/5</span>
        </div>
        <div class="progress" style="height: 20px;">
            <div class="progress-bar bg-primary" 
                role="progressbar" 
                style="width: 100.0%" 
                aria-valuenow="100.0" 
                aria-valuemin="0" 
                aria-valuemax="100">
                <span class="progress-percentage">100.0%</span>
            </div>
        </div>
    </div>
    
    <button id="startButton" class=" btn btn-success btn-lg">Start Exercise</button>
</div>
<!-- Exercise Container -->
<div id="exerciseContainer" class="flashcard-container d-none">
    <form id="exerciseForm" method="post" action="/submit_activity/5/">
        <input type="hidden" name="csrfmiddlewaretoken" value="oWZVJcyKDj79eJyKLWAFrFVNED6Pv0117vmaQI5vnkkImw9PwSFtpRINYRzCbW2h">
        <input type="hidden" name="responses" id="responses">
    </form>
    <div id="questions" class="questions-wrapper position-relative">
        
        <div class="question-card d-none" 
            data-item-id="3"
            data-item-successes="0"
            data-item-is-master="false"
            style="min-height: 45vh;">
                    <div class="question-content mb-2 position-relative">
                 <div class="question-text fs-5 mb-4">
                    T dsjkaljasdfkl ajf safjklds jfklsa fjkl as;jfldksa jfadls
 fjsakld fjsalk fjas fasdjkldf j
lasdf asfdsApple
                </div>
                
                <img src="/media/courses/1/course-image.png" class="img-fluid" alt="Question image">
                

                
                <div class="position-absolute top-0 end-0 mt-2">
                    <i class="bi bi-volume-up fs-2 text-primary" style="cursor: pointer;"></i>
                </div>
                <audio class="d-none" autoplay>
                    <source src="/media/courses/1/correct.mp3" type="audio/mpeg">
                </audio>
                

            </div>
            <div class="answer-buttons row g-2 mt-auto">
                <div class="col-12 text-end mb-1">
                    <a href="#" class="not-sure-link">Not Sure?</a>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="true">
                        Apple
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Pear
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Banana
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Jupiter
                    </button>
                </div>
                
            </div>
        </div>
        
        <div class="question-card d-none" 
            data-item-id="4"
            data-item-successes="0"
            data-item-is-master="false"
            style="min-height: 45vh;">
                    <div class="question-content mb-2 position-relative">
                 <div class="question-text fs-5 mb-4">
                    Orange
                </div>
                

                

            </div>
            <div class="answer-buttons row g-2 mt-auto">
                <div class="col-12 text-end mb-1">
                    <a href="#" class="not-sure-link">Not Sure?</a>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Apple
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Jupiter
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Pear
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="true">
                        Orange
                    </button>
                </div>
                
            </div>
        </div>
        
        <div class="question-card d-none" 
            data-item-id="5"
            data-item-successes="0"
            data-item-is-master="false"
            style="min-height: 45vh;">
           <div class="question-content mb-2 position-relative">
                 <div class="question-text fs-5 mb-4">
                    Pear
                </div>
                
            </div>
            <div class="answer-buttons row g-2 mt-auto">
                <div class="col-12 text-end mb-1">
                    <a href="#" class="not-sure-link">Not Sure?</a>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Banana
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Orange
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Apple
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="true">
                        Pear
                    </button>
                </div>
                
            </div>
        </div>
        
        <div class="question-card d-none" 
            data-item-id="6"
            data-item-successes="0"
            data-item-is-master="false"
            style="min-height: 45vh;">
                    <div class="question-content mb-2 position-relative">
                 <div class="question-text fs-5 mb-4">
                    Banana
                </div>
                

                
                <div class="position-absolute top-0 end-0 mt-2">
                    <i class="bi bi-volume-up fs-2 text-primary" style="cursor: pointer;"></i>
                </div>
                <audio class="d-none" autoplay>
                    <source src="/media/courses/1/correct_86HrEqM.mp3" type="audio/mpeg">
                </audio>
                

            </div>
            <div class="answer-buttons row g-2 mt-auto">
                <div class="col-12 text-end mb-1">
                    <a href="#" class="not-sure-link">Not Sure?</a>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Apple
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Jupiter
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="true">
                        Banana
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Orange
                    </button>
                </div>
                
            </div>
        </div>
        
        <div class="question-card d-none" 
            data-item-id="7"
            data-item-successes="0"
            data-item-is-master="false"
            style="min-height: 45vh;">
                    <div class="question-content mb-2 position-relative">
                 <div class="question-text fs-5 mb-4">
                    Jupiter
                </div>
                

                

            </div>
            <div class="answer-buttons row g-2 mt-auto">
                <div class="col-12 text-end mb-1">
                    <a href="#" class="not-sure-link">Not Sure?</a>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="true">
                        Jupiter
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Banana
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Pear
                    </button>
                </div>
                
                <div class="col-6">
                    <button type="button" class="btn btn-outline-primary w-100 answer-btn"
                            data-correct="false">
                        Orange
                    </button>
                </div>
                
            </div>
        </div>
        
    </div>
</div>

<!-- Modified Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1" style="position: absolute;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center">
                {% comment %} <h4 class="modal-title mb-3" id="feedbackResult"></h4>
                <p id="correctAnswerText"></p> {% endcomment %}
                <!-- Add progress icons container -->
                <div class="modal-body">
                    <p>Correct answers: <span id="correctCount">0</span>/10</p>
                </div>
                <div id="progressIcons" class="mb-3">
                    <div class="d-flex justify-content-center align-items-center gap-1">
                        <div class="progress-icons"></div>
                        <span class="ms-2 correct-count"></span>
                    </div>
                </div>        
                <div class="d-flex justify-content-center gap-2">
                    <button type="button" class="btn btn-primary" id="continueButton">Continue</button>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.not-sure-link {
    display: block;
    font-size: 1em;
    margin-top: 10px;
    text-decoration: none;
}
#questions {
    position: relative;
}
.progress-icon {
    color: #28a745;
    font-size: 0.6em;  /* Reduced from 1.2em to 0.6em (50% size) */
    margin: 0 2px;     /* Add small margins between icons */
}
.not-sure-link:hover {
text-decoration: underline;
}
.welcome-block {
    max-width: 800px;
    margin: 0 auto;
}
.question-card {
    min-height: 250px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}
.question-content {
    position: relative;
    padding-top: 10px; /* Make space for the audio icon */
}
.question-text {
    margin-right:40px ;
}
.answer-buttons button {
    white-space: normal;
    height: 100%;
    min-height: 60px;
}
.correct-answer {
    background-color: #d4edda !important;
    border-color: #28a745 !important;
}
.incorrect-answer {
    background-color: #f8d7da !important;
    border-color: #dc3545 !important;
}
.progress-container {
    max-width: 500px;
    margin: 0 auto;
}
/* Custom positioning for the modal */
#exerciseContainer .modal {
    position: absolute;
    top: -40%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1050;
    width: 90%;
    max-width: 500px;
    margin: 0;
    background: white;
}
#feedbackModal {
    top:-20%;
}
#exerciseContainer .modal-dialog {
    margin: 0;
    max-width: 100%;
}

/* Custom backdrop */
#exerciseContainer .modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(208, 208, 208, 0.5);
}
.active-activity{
    background-color:#cfe4fb;
}

.bi-volume-up {
    color: #0d6efd; /* Bootstrap primary color */
    transition: opacity 0.2s;
}

.bi-volume-up:hover {
    opacity: 0.8;
}
/* Add to your existing styles */
.selected-answer {
    border-width: 2px !important;
}
</style>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    let items = []; // Array of {id, successes, is_master, element}
    let newList = [];
    let workingList = [];
    let masterList = [];
    let currentItem = null;
    let correctCount = 0;
    let attemptCount = 0;
    const WORKING_LIMIT = 3;

    // Initialize data structures
    function initializeLists() {
        items = $('.question-card').map(function() {
            return {
                id: $(this).data('item-id'),          // Now correctly populated
                successes: $(this).data('item-successes') || 0, // Fixed key name
                is_master: $(this).data('item-is-master') === 'true', // Proper boolean
                element: this
            };
        }).get();

        // Categorize items
        newList = items.filter(item => item.successes === 0);
        workingList = items.filter(item => item.successes >= 1 && item.successes <= 2);
        masterList = items.filter(item => item.successes >= 3)
                         .sort((a, b) => a.successes - b.successes);        
        
    }

    

    function processNextItem() {
        // Check working list first
        if (workingList.length > 0) {
            currentItem = workingList.shift();
            showItem(currentItem);
            return;
        }

        // Check master list after every 3 attempts
        if (attemptCount % 3 === 0 && masterList.length > 0) {
            currentItem = masterList.shift();
            showItem(currentItem);
            return;
        }

        // Refill working list from new
        while (workingList.length < WORKING_LIMIT && newList.length > 0) {
            workingList.push(newList.shift());
        }

        if (workingList.length > 0) {
            currentItem = workingList.shift();
            showItem(currentItem);
        } else {
            // All items mastered
            showCompletion();
        }
    }

    function showItem(item) {
        $('.question-card').addClass('d-none');
        $(item.element).removeClass('d-none');
    }

    function handleAnswer(isCorrect) {
        const audio = isCorrect ? document.getElementById('audio-correct') : document.getElementById('audio-wrong');
        audio.play();

          // Add visual feedback
        $('.answer-btn').removeClass('selected-answer correct-answer incorrect-answer');
        $button.addClass('selected-answer ' + (isCorrect ? 'correct-answer' : 'incorrect-answer'));

        attemptCount++;
        currentItem.successes += isCorrect ? 1 : 0;

        if (isCorrect) {
            correctCount++;
            if (currentItem.successes >= 3) {
                masterList.push(currentItem);
                masterList.sort((a, b) => a.successes - b.successes);
            } else if (currentItem.successes > 0) {
                workingList.push(currentItem);
            }
        } else {
            if (currentItem.successes > 0) {
                workingList.push(currentItem);
            } else {
                newList.push(currentItem);
            }
        }

        showFeedback(isCorrect);
        
    }

    function showFeedback(isCorrect) {
        const modal = $('#feedbackModal');
        modal.find('.modal-title').text(isCorrect ? 'Correct!' : 'Incorrect');
        modal.find('#correctCount').text(correctCount);
        
        if (correctCount >= 10) {
            modal.find('#continueButton').hide();
            modal.find('#showResults').show();
        } else {
            modal.find('#continueButton').show();
            modal.find('#showResults').hide();
        }
        
        modal.modal('show');
    }

    function showCompletion() {
        $('#exerciseContainer').addClass('d-none');
        $('#welcomeBlock').removeClass('d-none');
        $('#masteredCount').text(masterList.length);
        $('#overallProgress').text(
            Math.round((masterList.length / items.length) * 100) + '%'
        );
    }

    // Event Handlers
    $('#startButton').click(function() {
        initializeLists();
        $('#welcomeBlock').addClass('d-none');
        $('#exerciseContainer').removeClass('d-none');
        processNextItem();
    });
    $('#stopButton').click(function() {
        // Prepare responses array
        const responses = items.map(item => ({
            item_id: item.id,
            successes: item.successes
        }));
        
        // Update hidden input and submit
        $('#responses').val(JSON.stringify(responses));
        $('#exerciseForm').submit();
        
        // Hide modal
        $('#feedbackModal').modal('hide');
    });
    $('.answer-btn').click(function() {
        const isCorrect = $(this).data('correct') === true;
        handleAnswer(isCorrect, $(this));
    });

    $('#continueButton').click(function() {
        $('#feedbackModal').modal('hide');
        processNextItem();
    });

    $('#showResults').click(function() {
        $('#feedbackModal').modal('hide');
        showCompletion();
    });
});
</script>

                    </div>
                    </div>
            </div>
        </div>                 
        <!-- Right Column - Lesson Navigation -->
<!-- Right Column - Lesson Navigation -->
<div class="col-12 col-md-4 mb-4 mb-md-0">
    <div class="card">
        <h5 class="card-header">Lesson 1</h5>
        <div class="card-body p-0">
            <div class="list-group">
                
                <a href="/activity/4/" 
                   class="list-group-item list-group-item-action d-flex flex-column 
                          ">
                    <div class="d-flex justify-content-between w-100 mb-2">
                        <span>1. This is a lesson activity.  The title is long.</span>
                        
                    </div>
                    <div class="progress w-100" style="height: 16px;">
                        <div class="progress-bar" 
                             role="progressbar" 
                             style="width: 60.0%; background-color: #007bff;
                                    display: flex; align-items: center; justify-content: center; position: relative;"
                             aria-valuenow="60.0" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            <span style="color: white; font-size: 0.65rem; font-weight: bold;
                                      position: absolute; left: 50%; transform: translateX(-50%);">
                                60%
                            </span>
                        </div>
                    </div>
                </a>
                
                <a href="/activity/5/" 
                   class="list-group-item list-group-item-action d-flex flex-column 
                          active-activity">
                    <div class="d-flex justify-content-between w-100 mb-2">
                        <span>2. Exercise Activity</span>
                        
                    </div>
                    <div class="progress w-100" style="height: 16px;">
                        <div class="progress-bar" 
                             role="progressbar" 
                             style="width: 100.0%; background-color: #007bff;
                                    display: flex; align-items: center; justify-content: center; position: relative;"
                             aria-valuenow="100.0" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            <span style="color: white; font-size: 0.65rem; font-weight: bold;
                                      position: absolute; left: 50%; transform: translateX(-50%);">
                                100%
                            </span>
                        </div>
                    </div>
                </a>
                
                <a href="/activity/7/" 
                   class="list-group-item list-group-item-action d-flex flex-column 
                          ">
                    <div class="d-flex justify-content-between w-100 mb-2">
                        <span>3. HTML Activity</span>
                        
                    </div>
                    <div class="progress w-100" style="height: 16px;">
                        <div class="progress-bar" 
                             role="progressbar" 
                             style="width: 9.0%; background-color: #007bff;
                                    display: flex; align-items: center; justify-content: center; position: relative;"
                             aria-valuenow="9.0" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            <span style="color: white; font-size: 0.65rem; font-weight: bold;
                                      position: absolute; left: 50%; transform: translateX(-50%);">
                                9%
                            </span>
                        </div>
                    </div>
                </a>
                
                <a href="/activity/6/" 
                   class="list-group-item list-group-item-action d-flex flex-column 
                          ">
                    <div class="d-flex justify-content-between w-100 mb-2">
                        <span>4. Video Activity</span>
                        
                    </div>
                    <div class="progress w-100" style="height: 16px;">
                        <div class="progress-bar" 
                             role="progressbar" 
                             style="width: 0%; background-color: #007bff;
                                    display: flex; align-items: center; justify-content: center; position: relative;"
                             aria-valuenow="0" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            <span style="color: white; font-size: 0.65rem; font-weight: bold;
                                      position: absolute; left: 50%; transform: translateX(-50%);">
                                0%
                            </span>
                        </div>
                    </div>
                </a>
                
            </div>
        </div>
    </div>
</div>

    </div>
</div>

   
  </body>
  
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
</html>
