{% extends "user/base.html" %}
{% load static %}
{% block content %}
<div class="container mt-5">
    {% if messages %}
    <div class="mb-3">
        {% for message in messages %}
        <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'warning' %}alert-warning{% endif %} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}      
    <div class="title-row">
        <h2 class="mb-0">My Courses</h2>
        <a class="btn btn-success add-btn" href="{% url 'available_courses' %}">
            âœš Add Course
        </a>
    </div>
    {% if enrollments %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for enrollment in enrollments %}
                <div class="col">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-4">
                                    {% if enrollment.course.image %}
                                    <img height="120" src="{{ enrollment.course.image.url }}"
                                        class="card-img-top"
                                        alt="{{ enrollment.course.title }}">
                                    {% endif %}
                                </div>
                                <div class="col-8">
                                    <h5 class="card-title">{{ enrollment.course.title }}</h5>
                                    <div class="progress mb-3">
                                        <div class="progress-bar"
                                            role="progressbar"
                                            style="width: {{ enrollment.progress|floatformat:'0' }}%"
                                            aria-valuenow="{{ enrollment.progress|floatformat:'0' }}"
                                            aria-valuemin="0"
                                            aria-valuemax="100">
                                            {{ enrollment.progress|floatformat:"0" }}%
                                        </div>
                                    </div>
                                    <div class="text-muted mb-2">
                                        Last Update: {{ enrollment.updated_at|date:"M d, Y" }}
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <a href="
                                                {% if enrollment.latest_activity_id %}
                                                    {% url 'course:activity_detail' enrollment.latest_activity_id %}
                                                {% elif enrollment.first_activity_id %}
                                                    {% url 'course:activity_detail' enrollment.first_activity_id %}
                                                {% else %}
                                                    {% url 'course:course' enrollment.course.id %}
                                                {% endif %}"
                                            class="btn btn-success me-2">
                                                {% if enrollment.progress == 0 %}
                                                    Start
                                                {% else %}
                                                    Continue
                                                {% endif %}
                                            </a>
                                            <a href="{% url 'revision' course_id=enrollment.course.id %}"
                                            class="btn btn-warning me-2">
                                                Revise
                                                {% if enrollment.revision_items_count > 0 %}
                                                    <span class="badge bg-danger ms-1">{{ enrollment.revision_items_count|floatformat:0 }}</span>
                                                {% endif %}
                                            </a>
                                        </div>
                                        <a href="{% url 'course:course' enrollment.course.id %}" class="btn btn-outline-secondary">
                                            <i class="bi bi-list"></i>
                                        </a>
                                    </div>
                                </div>                      
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">
            You haven't enrolled in any courses yet.
            <p></p>
            <a href="{% url 'available_courses' %}" class="alert-link">
                Browse available courses
            </a>
        </div>
    {% endif %}
</div>
<!-- Bootstrap JS (ensure it's included in the base template or add it here if needed) -->
{% endblock %}